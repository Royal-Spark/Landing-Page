<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Agenda AI - Royal Spark</title>
    <link rel="icon" type="image/png" href="https://dwtymuzolmglgyejxuve.supabase.co/storage/v1/object/public/podcasts//Royal%20Spark%20D%20Logo%20-%20Mekvold%20V3.png">

    <style>
        :root {
            --color-black: #000000;
            --color-white: #ffffff;
            --color-zinc-200: #e4e4e7;
            --color-zinc-300: #d4d4d8;
            --color-zinc-400: #a1a1aa;
            --color-zinc-500: #71717a;
            --color-zinc-700: #3f3f46;
            --color-zinc-800: #27272a;
            --color-zinc-900: #18181b;
            --color-zinc-950: #09090b;
            --color-purple-300: #d8b4fe;
            --color-purple-400: #c084fc;
            --color-purple-500: #a855f7;
            --color-purple-600: #9333ea;
            --color-purple-700: #7e22ce;
            --color-purple-900: #581c87;
            --color-cyan-200: #a5f3fc;
            --color-cyan-300: #67e8f9;
            --color-cyan-400: #22d3ee;
            --color-cyan-500: #06b6d4;
            --color-cyan-600: #0891b2;
            --color-cyan-900: #164e63;
            --color-green-400: #4ade80;
            --color-green-500: #22c55e;
            --color-red-500: #ef4444;
            --input-bg: rgba(24, 24, 27, 0.7);
        }

        html[data-theme='light'] {
            --color-black: #ffffff;
            --color-white: #000000;
            --color-zinc-200: #3f3f46;
            --color-zinc-300: #52525b;
            --color-zinc-400: #71717a;
            --color-zinc-500: #a1a1aa;
            --color-zinc-700: #d4d4d8;
            --color-zinc-800: #e4e4e7;
            --color-zinc-900: #f4f4f5;
            --color-zinc-950: #fafafa;
            --input-bg: #e4e4e7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-black);
            color: var(--color-white);
            line-height: 1.5;
            transition: background-color 0.3s, color 0.3s;
        }
        .container { width: 100%; }
        
        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            width: 100%;
            border-bottom: 1px solid var(--color-zinc-800);
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }
        html[data-theme='light'] .header {
            background-color: rgba(255, 255, 255, 0.8);
        }
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            height: 4rem;
            align-items: center;
            justify-content: space-between;
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .logo { height: 2.5rem; width: auto; }
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--color-purple-500), var(--color-cyan-400));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .desktop-nav { display: flex; gap: 1.5rem; }
        .nav-link {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-zinc-300);
            text-decoration: none;
            transition: color 0.2s;
        }
        .nav-link:hover { color: var(--color-white); }
        .theme-toggle-btn {
            background-color: var(--input-bg);
            border: 1px solid var(--color-zinc-700);
            color: var(--color-zinc-400);
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 1rem;
        }
        .theme-toggle-btn:hover {
            border-color: var(--color-purple-500);
            color: var(--color-white);
        }
        .theme-toggle-btn svg { width: 1.25rem; height: 1.25rem; }

        /* Main Content */
        .main {
          max-width: 1100px;
          margin: 1.5rem auto;
          padding: 1rem;
        }
        .card {
          background: rgba(39,39,42,0.55);
          border: 1px solid var(--color-zinc-800);
          border-radius: 12px;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
        }
        html[data-theme='light'] .card {
          background: rgba(244, 244, 245, 0.85);
        }
        label { display:block; margin-bottom:.5rem; color:var(--color-zinc-300); font-weight:600;}
        textarea, input, select {
          width:100%;
          border-radius:8px;
          padding:0.75rem;
          background:var(--input-bg);
          border:1px solid var(--color-zinc-700);
          color:var(--color-white);
          resize:vertical;
        }
        .controls { display:flex; gap:.75rem; margin-top:1rem; flex-wrap:wrap;}
        button { 
            background: linear-gradient(90deg, var(--color-purple-600), var(--color-cyan-500)); 
            border:none; 
            color:var(--color-white); 
            padding:.75rem 1.25rem; 
            border-radius:8px; 
            cursor:pointer; 
            font-weight:600;
            transition: all 0.2s;
        }
        button:hover {
            background: linear-gradient(to right, var(--color-purple-700), var(--color-cyan-600));
        }
        button.ghost { 
            background:transparent; 
            border:1px solid var(--color-zinc-700); 
            color:var(--color-zinc-300); 
        }
        button.ghost:hover {
            background: var(--color-zinc-800);
            color: var(--color-white);
        }
        button.danger {
             background: transparent;
             border: 1px solid var(--color-red-500);
             color: var(--color-red-500);
        }
        button.danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; background: var(--color-zinc-700); }
        .section-title { font-size:1.25rem; color:var(--color-white); font-weight:700; margin-bottom:1rem; }
        .small { font-size:.9rem; color:var(--color-zinc-400); }
        #resultArea { width:100%; min-height:160px; background:transparent; border:1px dashed var(--color-zinc-700); padding:0.75rem; border-radius:8px; color:var(--color-zinc-200); overflow:auto; white-space:pre-wrap;}
        .copy-success {
          background: linear-gradient(90deg, var(--color-green-500), var(--color-green-400)) !important;
        }

        /* Modal Dialog */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--color-zinc-900);
            border: 1px solid var(--color-zinc-800);
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 450px;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-white);
            margin-bottom: 0.75rem;
        }
        .modal-body {
            color: var(--color-zinc-300);
            margin-bottom: 1.5rem;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid var(--color-zinc-800);
            margin-top: 5rem;
            background-color: var(--color-black);
        }
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: var(--color-zinc-500);
            gap: 1rem;
        }
        @media (min-width: 640px) {
            .footer-container { flex-direction: row; }
        }
    </style>
</head>
<body>
  <div class="container">
    <header class="header">
        <div class="header-container">
            <a href="https://royal-spark.github.io/Landing-Page/" class="logo-container" style="text-decoration: none;">
                <img src="https://dwtymuzolmglgyejxuve.supabase.co/storage/v1/object/public/podcasts//Royal%20Spark%20D%20Logo%20-%20Mekvold%20V3.png" alt="Royal Spark Logo" class="logo">
                <span class="logo-text">Royal Spark</span>
            </a>
            <div style="display: flex; align-items: center;">
                <nav class="desktop-nav">
                    <a href="https://royal-spark.github.io/Landing-Page/" class="nav-link">Home</a>
                    <a href="#" class="nav-link" style="color: var(--color-white);">Agenda AI Tool</a>
                </nav>
                <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle theme">
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.106a.75.75 0 0 1 0 1.06l-1.591 1.59a.75.75 0 1 1-1.06-1.06l1.59-1.59a.75.75 0 0 1 1.06 0ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM17.894 17.894a.75.75 0 0 1-1.06 0l-1.59-1.591a.75.75 0 1 1 1.06-1.06l1.59 1.59a.75.75 0 0 1 0 1.061ZM12 18.75a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25a.75.75 0 0 1 .75-.75ZM5.106 17.894a.75.75 0 0 1 0-1.06l1.59-1.591a.75.75 0 1 1 1.06 1.06l-1.59 1.59a.75.75 0 0 1-1.06 0ZM4.5 12a.75.75 0 0 1-.75.75H1.5a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM6.106 5.106a.75.75 0 0 1 1.06 0l1.59 1.591a.75.75 0 0 1-1.06 1.06l-1.59-1.59a.75.75 0 0 1 0-1.061Z" /></svg>
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.981A10.503 10.503 0 0 1 18 19.5a10.5 10.5 0 0 1-10.5-10.5A10.503 10.503 0 0 1 9.528 1.718Z" clip-rule="evenodd" /></svg>
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <section class="card" aria-labelledby="input-heading">
            <h2 id="input-heading" class="section-title">Step 1: Provide Meeting Details</h2>
            <label for="fileInput">Upload file (.txt, .docx)</label>
            <input id="fileInput" type="file" accept=".txt,.docx" />

            <label for="meetingTitle" style="margin-top:.75rem">Meeting title</label>
            <input id="meetingTitle" type="text" placeholder="Weekly staff meeting — Q3 planning" />

            <label for="meetingDate" style="margin-top:.75rem">Meeting date</label>
            <input id="meetingDate" type="date" />

            <label for="attendees" style="margin-top:.75rem">Attendees</label>
            <input id="attendees" type="text" placeholder="Smith, Johnson, Williams, Brown" />

            <label for="pasteArea" style="margin-top:.75rem">Meeting notes / transcript</label>
            <textarea id="pasteArea" placeholder="Paste meeting transcript or notes here..." rows="10"></textarea>

            <div class="controls">
                <button id="generateBtn">Generate AI Prompt</button>
            </div>
            <p class="small" style="margin-top:.75rem">Tip: speaker labels like "Alice: ..." help extract action owners.</p>
        </section>

        <section class="card" aria-labelledby="prompt-heading">
            <h2 id="prompt-heading" class="section-title">Step 2: Use Generated Prompt</h2>
            <textarea id="resultArea" placeholder="Click 'Generate AI Prompt' to create the prompt..." rows="12" readonly></textarea>
            <div class="controls">
                <button id="copyBtn" disabled>Copy Prompt</button>
                <button id="niprgptBtn" disabled>Open NIPRGPT</button>
            </div>
            <p class="small" style="margin-top:.75rem">Copy this entire prompt and paste it into NIPRGPT. <strong>Recommendation:</strong> Switch to Claude 4 Sonnet in NIPRGPT for best results.</p>
        </section>

        <section class="card" aria-live="polite">
            <h2 class="section-title">Step 3: Finalize & Download</h2>
            <label for="aiOutput">Paste NIPRGPT AI Text Here</label>
            <textarea id="aiOutput" placeholder="Paste the AI's result from NIPRGPT here..." rows="12"></textarea>
            <div class="controls">
                <button id="downloadPdf" disabled>Download PDF</button>
            </div>
        </section>

        <div class="controls" style="justify-content: center;">
            <button id="resetBtn" class="danger">Reset Tool</button>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <p>© 2025 Royal Spark Innovation Lab. All rights reserved.</p>
            <p>An initiative of the 100th Air Refueling Wing.</p>
        </div>
    </footer>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmation-modal" class="modal-overlay">
      <div class="modal-content">
          <h3 class="modal-title">Are you sure?</h3>
          <p class="modal-body">This will clear all inputs and generated content. This action cannot be undone.</p>
          <div class="modal-actions">
              <button id="cancel-reset" class="ghost">Cancel</button>
              <button id="confirm-reset" class="danger">Confirm Reset</button>
          </div>
      </div>
  </div>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    (function(){
        // ===== UI refs =====
        const fileInput = document.getElementById('fileInput');
        const pasteArea = document.getElementById('pasteArea');
        const meetingTitle = document.getElementById('meetingTitle');
        const meetingDate = document.getElementById('meetingDate');
        const attendees = document.getElementById('attendees');
        const generateBtn = document.getElementById('generateBtn');
        const resultArea = document.getElementById('resultArea');
        const copyBtn = document.getElementById('copyBtn');
        const niprgptBtn = document.getElementById('niprgptBtn');
        const aiOutput = document.getElementById('aiOutput');
        const downloadPdf = document.getElementById('downloadPdf');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const resetBtn = document.getElementById('resetBtn');
        const modal = document.getElementById('confirmation-modal');
        const cancelBtn = document.getElementById('cancel-reset');
        const confirmBtn = document.getElementById('confirm-reset');

        // State
        let generatedPrompt = '';

        // Set today's date as default
        meetingDate.valueAsDate = new Date();

        // --- Theme Switcher Logic ---
        function applyTheme(theme) {
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let initialTheme = savedTheme || (prefersDark ? 'dark' : 'light');
        applyTheme(initialTheme);

        themeToggleBtn.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        // --- Reset Logic with Modal ---
        resetBtn.addEventListener('click', () => {
            modal.classList.add('visible');
        });

        cancelBtn.addEventListener('click', () => {
            modal.classList.remove('visible');
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                 modal.classList.remove('visible');
            }
        });

        confirmBtn.addEventListener('click', () => {
            pasteArea.value = '';
            meetingTitle.value = '';
            attendees.value = '';
            fileInput.value = '';
            resultArea.value = '';
            aiOutput.value = '';
            generatedPrompt = '';
            downloadPdf.disabled = true;
            copyBtn.disabled = true;
            niprgptBtn.disabled = true;
            modal.classList.remove('visible');
        });

        // --- File input: .txt and .docx via mammoth ---
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.name.endsWith('.docx')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    mammoth.extractRawText({ arrayBuffer: event.target.result })
                        .then(result => {
                            pasteArea.value = result.value;
                        })
                        .catch(err => {
                            console.error("Error reading .docx file:", err);
                            alert("Error reading .docx file.");
                        });
                };
                reader.readAsArrayBuffer(file);
            } else if (file.name.endsWith('.txt')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    pasteArea.value = event.target.result;
                };
                reader.readAsText(file);
            } else {
                alert('Unsupported file type. Please use .txt or .docx');
            }
        });
        
        // --- Generate prompt (no API call, just create the prompt text) ---
        generateBtn.addEventListener('click', () => {
            const notes = (pasteArea.value || '').trim();
            if (!notes) {
                alert('Please paste or upload notes before generating the prompt.');
                return;
            }

            const title = meetingTitle.value.trim() || 'Meeting Summary';
            const date = meetingDate.value || new Date().toISOString().split('T')[0];
            const attendeesList = attendees.value.trim() || 'Not specified';

            const systemPrompt = `You are Agenda AI, a professional meeting summary generator. Create a comprehensive briefing document based on the provided meeting notes.

Structure your response with these exact sections:

I. Executive Summary
* Provide a concise overview of the meeting's main purpose and key outcomes
* Highlight the most important decisions and action items

II. Problem Statement & Current Challenges
* Identify and describe the main issues or challenges discussed
* Include relevant quotes from participants when available

III. Key Discussion Points
* Summarize the main topics covered during the meeting
* Organize by theme or topic area
* Include important details and context

IV. Decisions Made
* List all decisions that were made during the meeting
* Be specific about what was decided and by whom if mentioned

V. Action Items
* List all action items with assigned owners when specified
* Include deadlines or timeframes if mentioned
* Format as clear, actionable tasks

VI. Next Steps & Follow-up
* Outline planned follow-up actions
* Mention any scheduled future meetings or deadlines
* Include any open questions or items requiring further discussion

Use professional language and maintain the formal tone of a briefing document. Include relevant quotes from participants when they add value or context.

Meeting Title: ${title}
Date: ${date}
Attendees: ${attendeesList}

Meeting Notes:
${notes}`;

            generatedPrompt = systemPrompt;
            resultArea.value = generatedPrompt;
            copyBtn.disabled = false;
            niprgptBtn.disabled = false;
        });

        // --- Copy prompt ---
        copyBtn.addEventListener('click', () => {
            navigator.clipboard?.writeText(generatedPrompt).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('copy-success');
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('copy-success');
                }, 2000);
            }).catch(() => {
                resultArea.select();
                document.execCommand('copy');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                setTimeout(() => copyBtn.textContent = originalText, 2000);
            });
        });

        // --- Open NIPRGPT in new tab ---
        niprgptBtn.addEventListener('click', () => {
            window.open('https://chat.niprgpt.mil/', '_blank');
        });

        // --- Enable PDF download when AI output is provided ---
        aiOutput.addEventListener('input', () => {
            downloadPdf.disabled = !aiOutput.value.trim();
        });

        // --- Download PDF with briefing document template ---
        downloadPdf.addEventListener('click', () => {
            const aiText = aiOutput.value.trim();
            if (!aiText) {
                alert('Please paste AI output before downloading PDF.');
                return;
            }

            const title = meetingTitle.value.trim() || 'Meeting Summary';
            const date = meetingDate.value || new Date().toISOString().split('T')[0];
            const attendeesList = attendees.value.trim() || 'Not specified';

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ unit: 'pt', format: 'letter' });
            
            let y = 60;
            const leftMargin = 60;
            const rightMargin = 552;
            const lineHeight = 16;
            const sectionSpacing = 20;
            const pageHeight = 792;
            const bottomMargin = 60;

            function checkNewPage(additionalSpace = 0) {
                if (y + additionalSpace > pageHeight - bottomMargin) {
                    doc.addPage();
                    y = 60;
                }
            }
            
            function addFormattedText(text) {
                const lines = text.split('\n');
                for (let line of lines) {
                    checkNewPage(lineHeight);
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(11);

                    if (line.startsWith('I. ') || line.startsWith('V. ') || line.startsWith('X.')) {
                        doc.setFont(undefined, 'bold');
                        doc.setFontSize(14);
                    }
                    
                    const wrappedLines = doc.splitTextToSize(line, rightMargin - leftMargin);
                    for (const wrappedLine of wrappedLines) {
                        checkNewPage(lineHeight);
                        doc.text(wrappedLine, leftMargin, y);
                        y += lineHeight;
                    }
                }
            }

            // Document header
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text(title, leftMargin, y);
            y += 26;

            // Metadata
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text(`Date: ${date}`, leftMargin, y);
            y += 16;
            doc.text(`Attendees: ${attendeesList}`, leftMargin, y);
            y += sectionSpacing;

            doc.setLineWidth(1);
            doc.line(leftMargin, y, rightMargin, y);
            y += sectionSpacing;

            addFormattedText(aiText);

            const filename = (title).replace(/[^a-zA-Z0-9]/g, '_') + '.pdf';
            doc.save(filename);
        });
    })();
  </script>
</body>
</html>
